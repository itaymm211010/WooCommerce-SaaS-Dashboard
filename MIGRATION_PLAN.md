# ×ª×•×›× ×™×ª ××™×’×¨×¦×™×”: LOVABLE â†’ Coolify + Supabase Self-Hosted

## ××˜×¨×•×ª ×”××™×’×¨×¦×™×”

1. âœ… ×”×¡×¨×ª ×ª×œ×•×ª ×‘-LOVABLE Cloud
2. âœ… ×©×œ×™×˜×” ××œ××” ×¢×œ ×”×ª×©×ª×™×ª
3. âœ… ×©×™××•×© ×‘×©×¨×ª Hetzner + Coolify
4. âœ… **××¤×¡ ×©×™× ×•×™×™ ×§×•×“** (×©××™×¨×” ×¢×œ ××¨×›×™×˜×§×˜×•×¨×” ×§×™×™××ª)

---

## ××¤×¨×˜ ×”×©×¨×ª

**Hetzner Server:**
- CPU: 4 vCPU
- RAM: 8 GB
- Disk: 80 GB SSD
- OS: Linux (×¢× Coolify ××•×ª×§×Ÿ)

**×“×¨×™×©×•×ª Supabase:**
- ××™× ×™××•×: 4GB RAM âœ…
- ××•××œ×¥: 8GB RAM âœ…
- × ××¦× ×‘××¤×¨×˜ ×”××•×©×œ×!

---

## ××¨×›×™×˜×§×˜×•×¨×” × ×•×›×—×™×ª (LOVABLE)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub Repo       â”‚
â”‚ (Source of Truth)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ git push
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LOVABLE Cloud     â”‚ â† × ×§×•×“×ª ×”×ª×œ×•×ª ×©×¨×•×¦×™× ×œ×”×¡×™×¨
â”‚  - Auto Deploy      â”‚
â”‚  - Build Pipeline   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend       â”‚  â”‚  Supabase       â”‚
â”‚  (Static)       â”‚  â”‚  - PostgreSQL   â”‚
â”‚  - React 18     â”‚  â”‚  - Edge Funcs   â”‚
â”‚  - Vite         â”‚  â”‚  - Auth         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ××¨×›×™×˜×§×˜×•×¨×” ×—×“×©×” (Coolify)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub Repo       â”‚
â”‚ (Source of Truth)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ git push
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Hetzner Server               â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Coolify              â”‚  â”‚
â”‚  â”‚  - Auto Deploy               â”‚  â”‚
â”‚  â”‚  - Docker Orchestration      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                       â”‚
â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚             â–¼              â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Frontend    â”‚  â”‚  Supabase    â”‚â”‚
â”‚  â”‚  (Docker)    â”‚  â”‚  (Docker)    â”‚â”‚
â”‚  â”‚  - React     â”‚  â”‚  - Postgres  â”‚â”‚
â”‚  â”‚  - Nginx     â”‚  â”‚  - PostgREST â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - Deno      â”‚â”‚
â”‚                    â”‚  - Auth      â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚  Grafana     â”‚                  â”‚
â”‚  â”‚  Monitoring  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ×¨×›×™×‘×™ ×”×¤×¨×•×™×§×˜ ×”×§×™×™××™×

### Frontend (React + Vite)

**×˜×›× ×•×œ×•×’×™×•×ª:**
- React 18.3.1
- TypeScript 5.5.3
- Vite 5.4.1 (SWC)
- TanStack Query 5.56.2
- Shadcn/UI (Radix + Tailwind)
- React Router 6.26.2
- Zod 3.23.8 (validation)
- i18next 25.6.0 (internationalization)

**×§×‘×¦×™ ×§×•× ×¤×™×’×•×¨×¦×™×”:**
- `vite.config.ts`
- `tsconfig.json`
- `tailwind.config.ts`
- `.env` (××©×ª× ×™ ×¡×‘×™×‘×”)

**Build:**
```bash
npm run build
# Output: dist/
```

---

### Backend (Supabase Edge Functions - Deno)

**Runtime:** Deno (×œ× Node.js!)

**17 Edge Functions:**

| Function | Purpose | Auth Required | Critical |
|----------|---------|---------------|----------|
| `woo-proxy` | WooCommerce API proxy | âœ… | ğŸ”´ CRITICAL |
| `sync-woo-products` | Sync products from WC | âœ… | ğŸ”´ CRITICAL |
| `bulk-sync-to-woo` | Bulk upload to WC | âœ… | ğŸ”´ CRITICAL |
| `update-woo-product` | Update single product | âœ… | ğŸ”´ CRITICAL |
| `sync-taxonomies` | Sync categories/tags | âœ… | ğŸŸ¡ IMPORTANT |
| `sync-global-attributes` | Sync attributes | âœ… | ğŸŸ¡ IMPORTANT |
| `woocommerce-order-status` | Webhook handler | âšª Public | ğŸ”´ CRITICAL |
| `manage-taxonomy` | CRUD for taxonomies | âœ… | ğŸŸ¢ NORMAL |
| `reset-user-password` | Password reset | âœ… | ğŸŸ¢ NORMAL |
| `handle-anomaly-response` | AI anomaly handler | âœ… | ğŸŸ¢ NORMAL |
| `ai-chat` | AI chat (Gemini) | âœ… | ğŸŸ¢ NORMAL |
| `agent-coordinator` | Multi-agent orchestration | âœ… | ğŸŸ¢ NORMAL |
| `sync-health-agent` | Health monitoring | âœ… | ğŸŸ¢ NORMAL |
| `detect-bugs` | Bug detection | âœ… | ğŸŸ¢ NORMAL |
| `generate-webhook-secret` | Generate secrets | âœ… | ğŸŸ¢ NORMAL |

**Shared Utilities:**
- `auth-middleware.ts` - Authentication/Authorization
- `store-utils.ts` - Secure credential access
- `validation-schemas.ts` - Zod schemas
- `webhook-middleware.ts` - HMAC verification
- `woocommerce-utils.ts` - WC API helpers
- `sync-logger.ts` - Audit logging

---

### Database Schema (PostgreSQL)

**Core Tables:**

```sql
-- Multi-tenant stores
stores (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users,
  name TEXT,
  url TEXT,
  consumer_key TEXT (encrypted),
  consumer_secret TEXT (encrypted),
  created_at TIMESTAMPTZ
)

-- Products
products (
  id UUID PRIMARY KEY,
  store_id UUID REFERENCES stores,
  woo_id INTEGER,
  name TEXT,
  sku TEXT,
  price NUMERIC,
  stock_quantity INTEGER,
  source TEXT ('woo' | 'local'),
  synced_at TIMESTAMPTZ,
  UNIQUE(store_id, woo_id)
)

-- Product Variations
product_variations (
  id UUID PRIMARY KEY,
  product_id UUID REFERENCES products,
  woo_id INTEGER,
  sku TEXT,
  price NUMERIC,
  attributes JSONB,
  synced_at TIMESTAMPTZ
)

-- Product Images
product_images (
  id UUID PRIMARY KEY,
  product_id UUID REFERENCES products,
  woo_id INTEGER,
  src TEXT,
  position INTEGER,
  synced_at TIMESTAMPTZ
)

-- Taxonomies (Categories, Tags, Brands)
taxonomies (
  id UUID PRIMARY KEY,
  store_id UUID REFERENCES stores,
  woo_id INTEGER,
  name TEXT,
  slug TEXT,
  type TEXT ('category' | 'tag' | 'brand'),
  parent_id UUID,
  synced_at TIMESTAMPTZ
)

-- Attributes (Color, Size, etc.)
store_attributes (
  id UUID PRIMARY KEY,
  store_id UUID REFERENCES stores,
  woo_id INTEGER,
  name TEXT,
  slug TEXT,
  type TEXT,
  synced_at TIMESTAMPTZ
)

store_attribute_terms (
  id UUID PRIMARY KEY,
  attribute_id UUID REFERENCES store_attributes,
  woo_id INTEGER,
  name TEXT,
  slug TEXT,
  synced_at TIMESTAMPTZ
)

-- Orders
orders (
  id UUID PRIMARY KEY,
  store_id UUID REFERENCES stores,
  woo_id INTEGER,
  status TEXT,
  total NUMERIC,
  customer_email TEXT,
  customer_name TEXT,
  billing_address JSONB,
  shipping_address JSONB,
  created_at TIMESTAMPTZ,
  synced_at TIMESTAMPTZ
)

-- Order Status Logs
order_status_logs (
  id UUID PRIMARY KEY,
  order_id UUID REFERENCES orders,
  old_status TEXT,
  new_status TEXT,
  changed_at TIMESTAMPTZ
)

-- Audit Logs
sync_logs (
  id UUID PRIMARY KEY,
  store_id UUID REFERENCES stores,
  operation TEXT,
  entity_type TEXT,
  entity_id TEXT,
  status TEXT,
  details JSONB,
  created_at TIMESTAMPTZ
)

webhook_logs (
  id UUID PRIMARY KEY,
  store_id UUID REFERENCES stores,
  event TEXT,
  payload JSONB,
  verified BOOLEAN,
  processed BOOLEAN,
  created_at TIMESTAMPTZ
)

credential_access_logs (
  id UUID PRIMARY KEY,
  store_id UUID REFERENCES stores,
  user_id UUID,
  action TEXT,
  ip_address TEXT,
  created_at TIMESTAMPTZ
)
```

**RLS Policies:**
- âœ… Multi-tenant isolation per user
- âœ… Manager vs Viewer roles
- âœ… PII masking for viewers (orders_summary view)

**Migrations:**
- Location: `/supabase/migrations/*.sql`
- Total: ~20 migration files
- Must be imported to new Supabase

---

## ××©×ª× ×™ ×¡×‘×™×‘×” (Environment Variables)

### Frontend (.env)
```bash
# Supabase Connection
VITE_SUPABASE_URL=https://ddwlhgpugjyruzejggoz.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=eyJhbGci...
VITE_SUPABASE_PROJECT_ID=ddwlhgpugjyruzejggoz

# Optional
VITE_OPENROUTER_API_KEY=sk-or-...
```

### Backend (Supabase Edge Functions)
```bash
# Auto-injected by Supabase
SUPABASE_URL=https://ddwlhgpugjyruzejggoz.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJhbGci... (SECRET!)

# Custom (set in LOVABLE dashboard)
OPENROUTER_API_KEY=sk-or-... (optional for AI features)
LOVABLE_API_KEY=... (used in ai-chat function)
```

---

## ×ª×•×›× ×™×ª ×‘×™×¦×•×¢ (7 ×™××™×)

### ×™×•× 1: ×”×›× ×”
- [x] ×ª×™×¢×•×“ ××¨×›×™×˜×§×˜×•×¨×” × ×•×›×—×™×ª âœ…
- [ ] ×”×›× ×ª ×¡×§×¨×™×¤×˜ ×’×™×‘×•×™ DB
- [ ] ×¨×©×™××ª ×›×œ ××©×ª× ×™ ×”×¡×‘×™×‘×”
- [ ] ×‘×“×™×§×ª Coolify (×’×™×©×”, ××¤×¨×˜)

### ×™×•× 2: ×”×§××ª Supabase ×¢×œ Coolify
- [ ] ×”×ª×§× ×ª Supabase ×‘-Coolify (Docker template)
- [ ] ×”×’×“×¨×ª PostgreSQL
- [ ] ×”×’×“×¨×ª PostgREST API
- [ ] ×”×’×“×¨×ª Supabase Auth
- [ ] ×”×’×“×¨×ª Realtime (×× × ×“×¨×©)

### ×™×•× 3: ×”×¢×‘×¨×ª Database
- [ ] ×™×™×¦×•× DB ×-LOVABLE (pg_dump)
- [ ] ×™×™×‘×•× schema ×œ-Supabase ×”×—×“×©
- [ ] ×™×™×‘×•× data
- [ ] ×‘×“×™×§×ª data integrity (row counts)
- [ ] ×‘×“×™×§×ª RLS policies

### ×™×•× 4: ×”×¢×‘×¨×ª Edge Functions
- [ ] Copy `/supabase/functions/` â†’ Supabase ×”×—×“×©
- [ ] ×”×’×“×¨×ª ××©×ª× ×™ ×¡×‘×™×‘×” ×‘-Coolify
- [ ] Deploy ×›×œ 17 Functions
- [ ] ×‘×“×™×§×” ×¤×•× ×§×¦×™×” ××—×¨ ×¤×•× ×§×¦×™×”
- [ ] ×‘×“×™×§×ª authentication

### ×™×•× 5: Frontend
- [ ] ×¢×“×›×•×Ÿ `.env` (URL ×”×—×“×© ×©×œ Supabase)
- [ ] Build: `npm run build`
- [ ] Deploy ×œ-Coolify (Dockerfile ××• static)
- [ ] ×”×’×“×¨×ª domain/subdomain
- [ ] ×‘×“×™×§×•×ª integration ××œ××•×ª

### ×™×•× 6: Testing & QA
- [ ] ×‘×“×™×§×ª sync ××•×¦×¨×™× ×-WooCommerce
- [ ] ×‘×“×™×§×ª sync ××•×¦×¨×™× ××œ WooCommerce
- [ ] ×‘×“×™×§×ª webhooks (order status)
- [ ] ×‘×“×™×§×ª authentication + authorization
- [ ] ×‘×“×™×§×ª AI features (chat, anomaly detection)
- [ ] ×‘×“×™×§×•×ª performance

### ×™×•× 7: Monitoring & Production
- [ ] ×”×’×“×¨×ª Grafana ×‘-Coolify
- [ ] ×”×’×“×¨×ª dashboards (CPU, RAM, DB connections)
- [ ] ×”×’×“×¨×ª ×’×™×‘×•×™×™× ××•×˜×•××˜×™×™× (pg_dump cron)
- [ ] ×”×’×“×¨×ª alerts (email/webhook)
- [ ] ×ª×™×¢×•×“ ×œ××©×ª××©×™×
- [ ] Go Live! ğŸš€

---

## ×¡×™×›×•× ×™× ×•××¡×˜×¨×˜×’×™×•×ª ×¦××¦×•×

| ×¡×™×›×•×Ÿ | ×”×©×¤×¢×” | ×¡×‘×™×¨×•×ª | ×¦××¦×•× |
|-------|--------|---------|-------|
| ××™×‘×•×“ × ×ª×•× ×™× ×‘××™×’×¨×¦×™×” | ğŸ”´ HIGH | ğŸŸ¢ LOW | ×’×™×‘×•×™ ××œ× ×œ×¤× ×™, ×‘×“×™×§×ª integrity ××—×¨×™ |
| Edge Functions ×œ× ×¢×•×‘×“×•×ª | ğŸŸ¡ MED | ğŸŸ¡ MED | ×‘×“×™×§×” ×¤×•× ×§×¦×™×” ××—×¨ ×¤×•× ×§×¦×™×”, ×©××™×¨×ª LOVABLE ×›-fallback |
| Downtime ×××•×©×š | ğŸŸ¡ MED | ğŸŸ¢ LOW | ××™×’×¨×¦×™×” ×‘-staging ×ª×—×™×œ×” |
| ×‘×¢×™×•×ª performance | ğŸŸ¢ LOW | ğŸŸ¡ MED | Monitoring ×¢× Grafana, scaling ×× × ×“×¨×© |
| ×‘×¢×™×•×ª RLS/Auth | ğŸŸ¡ MED | ğŸŸ¢ LOW | ×‘×“×™×§×•×ª ×™×¡×•×“×™×•×ª ×œ×¤× ×™ production |

---

## Rollback Plan

×× ××©×”×• ××©×ª×‘×©:

1. **Frontend:** ×©×™× ×•×™ `.env` ×—×–×¨×” ×œ-LOVABLE URL
2. **Database:** LOVABLE DB ×¢×“×™×™×Ÿ ×§×™×™× (×œ× × ××—×§!)
3. **Edge Functions:** LOVABLE Functions ×¢×“×™×™×Ÿ ×¨×¦×•×ª
4. **×–××Ÿ rollback:** < 5 ×“×§×•×ª

**×—×©×•×‘:** ×œ× ×œ××—×•×§ ×©×•× ×“×‘×¨ ×‘-LOVABLE ×¢×“ ×©×”×›×œ ×¢×•×‘×“ 100% ×¢×œ Coolify!

---

## Checklist ×¡×•×¤×™ ×œ×¤× ×™ Go-Live

- [ ] ×›×œ ×”×˜×‘×œ××•×ª ×‘DB ×§×™×™××•×ª
- [ ] ×›×œ ×”-17 Edge Functions ×¨×¦×•×ª
- [ ] RLS policies ×¤×¢×™×œ×•×ª
- [ ] Authentication ×¢×•×‘×“
- [ ] WooCommerce sync ×¢×•×‘×“ (×©× ×™ ×›×™×•×•× ×™×)
- [ ] Webhooks ××§×‘×œ×™× × ×ª×•× ×™×
- [ ] AI features ×¢×•×‘×“×•×ª
- [ ] Performance ×˜×•×‘ (< 2s response time)
- [ ] Backups ××•×’×“×¨×™×
- [ ] Monitoring ×¤×¢×™×œ
- [ ] Documentation ×¢×“×›× ×™

---

## ×§×™×©×•×¨×™× ×—×©×•×‘×™×

**Documentation:**
- Supabase Self-Hosting: https://supabase.com/docs/guides/self-hosting
- Coolify Docs: https://coolify.io/docs
- Deno Deploy (Edge Functions): https://deno.com/deploy/docs

**GitHub:**
- Current Repo: https://github.com/itaymm211010/WooCommerce-SaaS-Dashboard
- Branch: `claude/project-planning-discussion-011CUxyJJDkEPEtZX5j4DgSk`

**LOVABLE (current):**
- Project ID: `bf95ed21-9695-47bb-bea2-c1f45246d48b`
- Supabase Project: `ddwlhgpugjyruzejggoz`

---

**×¢×“×›×•×Ÿ ××—×¨×•×Ÿ:** 2025-11-09
**×¡×˜×˜×•×¡:** ğŸ“ Planning Phase
