# ×ª×•×›× ×™×ª ××™×’×¨×¦×™×”: LOVABLE â†’ Coolify + Supabase Self-Hosted

## ××˜×¨×•×ª ×”××™×’×¨×¦×™×”

1. âœ… ×”×¡×¨×ª ×ª×œ×•×ª ×‘-LOVABLE Cloud
2. âœ… ×©×œ×™×˜×” ××œ××” ×¢×œ ×”×ª×©×ª×™×ª
3. âœ… ×©×™××•×© ×‘×©×¨×ª Hetzner + Coolify
4. âœ… **××¤×¡ ×©×™× ×•×™×™ ×§×•×“** (×©××™×¨×” ×¢×œ ××¨×›×™×˜×§×˜×•×¨×” ×§×™×™××ª)

---

## ××¤×¨×˜ ×”×©×¨×ª

**Hetzner Server:**
- CPU: 4 vCPU
- RAM: 8 GB
- Disk: 80 GB SSD
- OS: Linux (×¢× Coolify ××•×ª×§×Ÿ)

**×“×¨×™×©×•×ª Supabase:**
- ××™× ×™××•×: 4GB RAM âœ…
- ××•××œ×¥: 8GB RAM âœ…
- × ××¦× ×‘××¤×¨×˜ ×”××•×©×œ×!

---

## ××¨×›×™×˜×§×˜×•×¨×” × ×•×›×—×™×ª (LOVABLE)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub Repo       â”‚
â”‚ (Source of Truth)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ git push
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LOVABLE Cloud     â”‚ â† × ×§×•×“×ª ×”×ª×œ×•×ª ×©×¨×•×¦×™× ×œ×”×¡×™×¨
â”‚  - Auto Deploy      â”‚
â”‚  - Build Pipeline   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend       â”‚  â”‚  Supabase       â”‚
â”‚  (Static)       â”‚  â”‚  - PostgreSQL   â”‚
â”‚  - React 18     â”‚  â”‚  - Edge Funcs   â”‚
â”‚  - Vite         â”‚  â”‚  - Auth         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ××¨×›×™×˜×§×˜×•×¨×” ×—×“×©×” (Coolify)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub Repo       â”‚
â”‚ (Source of Truth)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ git push
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Hetzner Server               â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Coolify              â”‚  â”‚
â”‚  â”‚  - Auto Deploy               â”‚  â”‚
â”‚  â”‚  - Docker Orchestration      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                       â”‚
â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚             â–¼              â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Frontend    â”‚  â”‚  Supabase    â”‚â”‚
â”‚  â”‚  (Docker)    â”‚  â”‚  (Docker)    â”‚â”‚
â”‚  â”‚  - React     â”‚  â”‚  - Postgres  â”‚â”‚
â”‚  â”‚  - Nginx     â”‚  â”‚  - PostgREST â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - Deno      â”‚â”‚
â”‚                    â”‚  - Auth      â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚  Grafana     â”‚                  â”‚
â”‚  â”‚  Monitoring  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ×¨×›×™×‘×™ ×”×¤×¨×•×™×§×˜ ×”×§×™×™××™×

### Frontend (React + Vite)

**×˜×›× ×•×œ×•×’×™×•×ª:**
- React 18.3.1
- TypeScript 5.5.3
- Vite 5.4.1 (SWC)
- TanStack Query 5.56.2
- Shadcn/UI (Radix + Tailwind)
- React Router 6.26.2
- Zod 3.23.8 (validation)
- i18next 25.6.0 (internationalization)

**×§×‘×¦×™ ×§×•× ×¤×™×’×•×¨×¦×™×”:**
- `vite.config.ts`
- `tsconfig.json`
- `tailwind.config.ts`
- `.env` (××©×ª× ×™ ×¡×‘×™×‘×”)

**Build:**
```bash
npm run build
# Output: dist/
```

---

### Backend (Supabase Edge Functions - Deno)

**Runtime:** Deno (×œ× Node.js!)

**17 Edge Functions:**

| Function | Purpose | Auth Required | Critical |
|----------|---------|---------------|----------|
| `woo-proxy` | WooCommerce API proxy | âœ… | ğŸ”´ CRITICAL |
| `sync-woo-products` | Sync products from WC | âœ… | ğŸ”´ CRITICAL |
| `bulk-sync-to-woo` | Bulk upload to WC | âœ… | ğŸ”´ CRITICAL |
| `update-woo-product` | Update single product | âœ… | ğŸ”´ CRITICAL |
| `sync-taxonomies` | Sync categories/tags | âœ… | ğŸŸ¡ IMPORTANT |
| `sync-global-attributes` | Sync attributes | âœ… | ğŸŸ¡ IMPORTANT |
| `woocommerce-order-status` | Webhook handler | âšª Public | ğŸ”´ CRITICAL |
| `manage-taxonomy` | CRUD for taxonomies | âœ… | ğŸŸ¢ NORMAL |
| `reset-user-password` | Password reset | âœ… | ğŸŸ¢ NORMAL |
| `handle-anomaly-response` | AI anomaly handler | âœ… | ğŸŸ¢ NORMAL |
| `ai-chat` | AI chat (Gemini) | âœ… | ğŸŸ¢ NORMAL |
| `agent-coordinator` | Multi-agent orchestration | âœ… | ğŸŸ¢ NORMAL |
| `sync-health-agent` | Health monitoring | âœ… | ğŸŸ¢ NORMAL |
| `detect-bugs` | Bug detection | âœ… | ğŸŸ¢ NORMAL |
| `generate-webhook-secret` | Generate secrets | âœ… | ğŸŸ¢ NORMAL |

**Shared Utilities:**
- `auth-middleware.ts` - Authentication/Authorization
- `store-utils.ts` - Secure credential access
- `validation-schemas.ts` - Zod schemas
- `webhook-middleware.ts` - HMAC verification
- `woocommerce-utils.ts` - WC API helpers
- `sync-logger.ts` - Audit logging

---

### Database Schema (PostgreSQL)

**ğŸ“Š Full Schema Documentation:** See [DATABASE_SCHEMA.md](./DATABASE_SCHEMA.md)

**Summary Statistics:**
- **Tables:** 32
- **Views:** 4
- **Functions:** 13
- **Triggers:** 29
- **Indexes:** 108+
- **RLS Policies:** 100+
- **Enums:** 3
- **Migration Files:** 48

**Table Categories:**

1. **User Management (3):** profiles, user_roles, store_users
2. **Store Management (1):** stores
3. **Product Management (5):** products, product_images, product_variations, product_attributes, store_attributes
4. **Taxonomy (4):** store_categories, store_tags, store_brands, store_attribute_terms
5. **Orders (2):** orders, order_status_logs
6. **Webhooks (2):** webhooks, webhook_logs
7. **Sync (3):** taxonomy_sync_log, sync_logs, sync_errors
8. **Project Management (8):** sprints, tasks, work_logs, task_comments, project_alerts, task_logs, bug_reports, deployments
9. **AI Agents (3):** agent_insights, agent_alerts, agent_execution_log
10. **Security (4):** credential_access_logs, webhook_log_rate_limit, audit_logs, anomaly_response_actions

**Critical Security Features:**
- âœ… **RLS enabled on all 32 tables**
- âœ… **Multi-tenant isolation** (store-level access control)
- âœ… **Role-based permissions** (admin, owner, manager, viewer)
- âœ… **PII masking** for viewers (orders_summary view)
- âœ… **Audit logging** (14 tables monitored)
- âœ… **Webhook rate limiting** (1000/hour per store)
- âœ… **Credential access logging**
- âœ… **SQL injection prevention** (SET search_path = public)

**Migrations:**
- Location: `/supabase/migrations/*.sql`
- Total: **48 migration files** (chronological order required!)
- Must be executed sequentially during import

---

## ××©×ª× ×™ ×¡×‘×™×‘×” (Environment Variables)

### Frontend (.env)
```bash
# Supabase Connection
VITE_SUPABASE_URL=https://ddwlhgpugjyruzejggoz.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=eyJhbGci...
VITE_SUPABASE_PROJECT_ID=ddwlhgpugjyruzejggoz

# Optional
VITE_OPENROUTER_API_KEY=sk-or-...
```

### Backend (Supabase Edge Functions)
```bash
# Auto-injected by Supabase
SUPABASE_URL=https://ddwlhgpugjyruzejggoz.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJhbGci... (SECRET!)

# Custom (set in LOVABLE dashboard)
OPENROUTER_API_KEY=sk-or-... (optional for AI features)
LOVABLE_API_KEY=... (used in ai-chat function)
```

---

## ×ª×•×›× ×™×ª ×‘×™×¦×•×¢ (7 ×™××™×)

### ×™×•× 1: ×”×›× ×”
- [x] ×ª×™×¢×•×“ ××¨×›×™×˜×§×˜×•×¨×” × ×•×›×—×™×ª âœ…
- [ ] ×”×›× ×ª ×¡×§×¨×™×¤×˜ ×’×™×‘×•×™ DB
- [ ] ×¨×©×™××ª ×›×œ ××©×ª× ×™ ×”×¡×‘×™×‘×”
- [ ] ×‘×“×™×§×ª Coolify (×’×™×©×”, ××¤×¨×˜)

### ×™×•× 2: ×”×§××ª Supabase ×¢×œ Coolify
- [ ] ×”×ª×§× ×ª Supabase ×‘-Coolify (Docker template)
- [ ] ×”×’×“×¨×ª PostgreSQL
- [ ] ×”×’×“×¨×ª PostgREST API
- [ ] ×”×’×“×¨×ª Supabase Auth
- [ ] ×”×’×“×¨×ª Realtime (×× × ×“×¨×©)

### ×™×•× 3: ×”×¢×‘×¨×ª Database
- [ ] ×™×™×¦×•× DB ×-LOVABLE (pg_dump)
- [ ] ×™×™×‘×•× schema ×œ-Supabase ×”×—×“×©
- [ ] ×™×™×‘×•× data
- [ ] ×‘×“×™×§×ª data integrity (row counts)
- [ ] ×‘×“×™×§×ª RLS policies

### ×™×•× 4: ×”×¢×‘×¨×ª Edge Functions
- [ ] Copy `/supabase/functions/` â†’ Supabase ×”×—×“×©
- [ ] ×”×’×“×¨×ª ××©×ª× ×™ ×¡×‘×™×‘×” ×‘-Coolify
- [ ] Deploy ×›×œ 17 Functions
- [ ] ×‘×“×™×§×” ×¤×•× ×§×¦×™×” ××—×¨ ×¤×•× ×§×¦×™×”
- [ ] ×‘×“×™×§×ª authentication

### ×™×•× 5: Frontend
- [ ] ×¢×“×›×•×Ÿ `.env` (URL ×”×—×“×© ×©×œ Supabase)
- [ ] Build: `npm run build`
- [ ] Deploy ×œ-Coolify (Dockerfile ××• static)
- [ ] ×”×’×“×¨×ª domain/subdomain
- [ ] ×‘×“×™×§×•×ª integration ××œ××•×ª

### ×™×•× 6: Testing & QA
- [ ] ×‘×“×™×§×ª sync ××•×¦×¨×™× ×-WooCommerce
- [ ] ×‘×“×™×§×ª sync ××•×¦×¨×™× ××œ WooCommerce
- [ ] ×‘×“×™×§×ª webhooks (order status)
- [ ] ×‘×“×™×§×ª authentication + authorization
- [ ] ×‘×“×™×§×ª AI features (chat, anomaly detection)
- [ ] ×‘×“×™×§×•×ª performance

### ×™×•× 7: Monitoring & Production
- [ ] ×”×’×“×¨×ª Grafana ×‘-Coolify
- [ ] ×”×’×“×¨×ª dashboards (CPU, RAM, DB connections)
- [ ] ×”×’×“×¨×ª ×’×™×‘×•×™×™× ××•×˜×•××˜×™×™× (pg_dump cron)
- [ ] ×”×’×“×¨×ª alerts (email/webhook)
- [ ] ×ª×™×¢×•×“ ×œ××©×ª××©×™×
- [ ] Go Live! ğŸš€

---

## ×¡×™×›×•× ×™× ×•××¡×˜×¨×˜×’×™×•×ª ×¦××¦×•×

| ×¡×™×›×•×Ÿ | ×”×©×¤×¢×” | ×¡×‘×™×¨×•×ª | ×¦××¦×•× |
|-------|--------|---------|-------|
| ××™×‘×•×“ × ×ª×•× ×™× ×‘××™×’×¨×¦×™×” | ğŸ”´ HIGH | ğŸŸ¢ LOW | ×’×™×‘×•×™ ××œ× ×œ×¤× ×™, ×‘×“×™×§×ª integrity ××—×¨×™ |
| Edge Functions ×œ× ×¢×•×‘×“×•×ª | ğŸŸ¡ MED | ğŸŸ¡ MED | ×‘×“×™×§×” ×¤×•× ×§×¦×™×” ××—×¨ ×¤×•× ×§×¦×™×”, ×©××™×¨×ª LOVABLE ×›-fallback |
| Downtime ×××•×©×š | ğŸŸ¡ MED | ğŸŸ¢ LOW | ××™×’×¨×¦×™×” ×‘-staging ×ª×—×™×œ×” |
| ×‘×¢×™×•×ª performance | ğŸŸ¢ LOW | ğŸŸ¡ MED | Monitoring ×¢× Grafana, scaling ×× × ×“×¨×© |
| ×‘×¢×™×•×ª RLS/Auth | ğŸŸ¡ MED | ğŸŸ¢ LOW | ×‘×“×™×§×•×ª ×™×¡×•×“×™×•×ª ×œ×¤× ×™ production |

---

## Rollback Plan

×× ××©×”×• ××©×ª×‘×©:

1. **Frontend:** ×©×™× ×•×™ `.env` ×—×–×¨×” ×œ-LOVABLE URL
2. **Database:** LOVABLE DB ×¢×“×™×™×Ÿ ×§×™×™× (×œ× × ××—×§!)
3. **Edge Functions:** LOVABLE Functions ×¢×“×™×™×Ÿ ×¨×¦×•×ª
4. **×–××Ÿ rollback:** < 5 ×“×§×•×ª

**×—×©×•×‘:** ×œ× ×œ××—×•×§ ×©×•× ×“×‘×¨ ×‘-LOVABLE ×¢×“ ×©×”×›×œ ×¢×•×‘×“ 100% ×¢×œ Coolify!

---

## Checklist ×¡×•×¤×™ ×œ×¤× ×™ Go-Live

- [ ] ×›×œ ×”×˜×‘×œ××•×ª ×‘DB ×§×™×™××•×ª
- [ ] ×›×œ ×”-17 Edge Functions ×¨×¦×•×ª
- [ ] RLS policies ×¤×¢×™×œ×•×ª
- [ ] Authentication ×¢×•×‘×“
- [ ] WooCommerce sync ×¢×•×‘×“ (×©× ×™ ×›×™×•×•× ×™×)
- [ ] Webhooks ××§×‘×œ×™× × ×ª×•× ×™×
- [ ] AI features ×¢×•×‘×“×•×ª
- [ ] Performance ×˜×•×‘ (< 2s response time)
- [ ] Backups ××•×’×“×¨×™×
- [ ] Monitoring ×¤×¢×™×œ
- [ ] Documentation ×¢×“×›× ×™

---

## ×§×™×©×•×¨×™× ×—×©×•×‘×™×

**Documentation:**
- Supabase Self-Hosting: https://supabase.com/docs/guides/self-hosting
- Coolify Docs: https://coolify.io/docs
- Deno Deploy (Edge Functions): https://deno.com/deploy/docs

**GitHub:**
- Current Repo: https://github.com/itaymm211010/WooCommerce-SaaS-Dashboard
- Branch: `claude/project-planning-discussion-011CUxyJJDkEPEtZX5j4DgSk`

**LOVABLE (current):**
- Project ID: `bf95ed21-9695-47bb-bea2-c1f45246d48b`
- Supabase Project: `ddwlhgpugjyruzejggoz`

---

**×¢×“×›×•×Ÿ ××—×¨×•×Ÿ:** 2025-11-09
**×¡×˜×˜×•×¡:** ğŸ“ Planning Phase
